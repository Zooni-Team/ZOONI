@model Zooni.Models.Mascota
@{
    ViewData["Title"] = "Registro Mascota - Detalles";
    Layout = null;

    var especie = ViewBag.MascotaEspecie?.ToString()?.ToLower() ?? "perro";
    var imagenSuperior = $"/img/cajas/{especie}caja.png";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"]</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

    <style>
        :root {
            --marron: #8B5E3C;
            --amarillo: #FFD85A;
            --verde: #3ac37d;
            --gris: #555;
            --gris-claro: #ccc;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }

        .titulo-principal {
            text-align: center;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .titulo-principal h1 {
            color: var(--marron);
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0;
        }

        .titulo-principal h2 {
            color: var(--gris);
            font-weight: 700;
            font-size: 1.15rem;
            margin: 0.3rem 0 1.5rem;
        }

        .contenedor {
            background: #fff;
            border-radius: 25px;
            box-shadow: 0px 8px 25px rgba(0, 0, 0, 0.08);
            padding: 2.2rem 2rem 2.5rem;
            text-align: center;
            width: 90%;
            max-width: 420px;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeUp 0.8s ease forwards;
        }

        @@keyframes fadeUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .volver {
            position: absolute;
            top: 18px;
            left: 18px;
            background: none;
            border: none;
            font-size: 28px;
            color: var(--marron);
            cursor: pointer;
            transition: transform 0.2s ease, color 0.2s ease;
            z-index: 5;
        }

        .volver:hover {
            transform: scale(1.1);
            color: var(--verde);
        }

        h3 {
            color: var(--marron);
            font-weight: 700;
            font-size: 1.6rem;
            margin: 0.8rem 0 1.2rem;
            line-height: 1.3;
        }

        img.mascota-caja {
            width: 180px;
            margin-bottom: 1.2rem;
            object-fit: contain;
            image-rendering: crisp-edges;
        }

        form {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 14px;
            width: 100%;
            z-index: 4;
        }

        select, input {
            width: 100%;
            max-width: 320px;
            padding: 12px 14px;
            border-radius: 20px;
            border: 1.8px solid var(--gris-claro);
            text-align: center;
            font-size: 15px;
            outline: none;
            transition: border 0.2s ease, box-shadow 0.2s ease;
            background: #fff;
        }

        select:focus, input:focus {
            border-color: var(--verde);
            box-shadow: 0 0 0 2px rgba(58, 195, 125, 0.25);
        }

        label {
            color: var(--marron);
            font-weight: 600;
            margin-top: 0.3rem;
            font-size: 0.95rem;
        }

        input[type="range"] {
            width: 100%;
            accent-color: var(--amarillo);
            cursor: pointer;
        }

        .edad-texto, .peso-texto {
            font-weight: 600;
            color: var(--marron);
            margin-top: 0.3rem;
            font-size: 0.95rem;
            text-align: center;
        }

        .btn-principal {
            background-color: var(--verde);
            color: #fff;
            border: none;
            border-radius: 25px;
            padding: 12px 40px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.25s ease;
            margin-top: 1.3rem;
            width: 100%;
            max-width: 320px;
            font-weight: 600;
        }

        .btn-principal:hover {
            background-color: #2fa567;
            transform: translateY(-2px);
        }

        .imagen-bienvenida {
            position: absolute;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            pointer-events: none;
            z-index: 1;
        }

        .imagen-bienvenida img {
            width: 100%;
            max-width: 900px;
            object-fit: cover;
        }

        @@media (max-width: 768px) {
            .contenedor { padding: 1.5rem; max-width: 360px; }
            h3 { font-size: 1.4rem; }
        }

        @@media (max-width: 480px) {
            .contenedor { padding: 1.2rem; max-width: 340px; }
            h3 { font-size: 1.3rem; }
            .volver { top: 12px; left: 12px; font-size: 24px; }
        }

        .edad-container, .peso-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 320px;
            margin-top: 0.8rem;
        }

        .foto-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 1.2rem;
            gap: 0.6rem;
        }

        .foto-label {
            color: var(--marron);
            font-weight: 600;
            font-size: 1.05rem;
        }

        .btn-secundario {
            background-color: #ffd85a;
            color: #5b4500;
            border: none;
            border-radius: 25px;
            padding: 10px 30px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .btn-secundario:hover { background-color: #ffc93c; }
    </style>
</head>

<body>
    <div class="titulo-principal">
        <h1>Zooni</h1>
        <h2>¬°Registrate!</h2>
    </div>

    <div class="contenedor">
<button class="volver" onclick="window.location.href='/Registro/Registro2?volver=true'">‚Üê</button>
        <h3>Complet√° los datos de tu @ViewBag.MascotaEspecie üêæ</h3>
        <img src="@imagenSuperior" alt="Mascota en caja" class="mascota-caja" />

        <form asp-action="Registro3Post" asp-controller="Registro" method="post">
    @Html.AntiForgeryToken()

    <!-- üîπ Campo oculto para modo -->
    <input type="hidden" name="modo" value="@ViewBag.Modo ?? "normal"" />

    <!-- üîπ Campo oculto para especie -->
    <input type="hidden" name="Especie" value="@ViewBag.MascotaEspecie" />

    <!-- SEXO -->
    <select name="Sexo" required>
        <option value="">Sexo</option>
        <option value="Macho">Macho</option>
        <option value="Hembra">Hembra</option>
    </select>

    <!-- RAZA -->
    <select id="Raza" name="Raza" required>
        <option value="">Seleccion√° una opci√≥n</option>
    </select>

    <!-- PESO -->
    <div class="peso-container">
        <label for="Peso">Peso (kg)</label>
        <input type="range" id="Peso" name="Peso" min="0" max="50" step="0.1" value="5" />
        <div class="peso-texto" id="pesoTexto">5 kg</div>
    </div>

    <!-- EDAD -->
    <div class="edad-container">
        <label for="Edad">Edad</label>
        <input type="range" id="Edad" name="Edad" min="0" max="240" value="0" />
        <div class="edad-texto" id="edadTexto">0 meses</div>
    </div>

    <!-- FOTO -->
    <div class="foto-container">
        <label for="fotoMascota" class="foto-label">üì∏ Sacale una foto a tu mascota</label>
        <video id="video" autoplay playsinline style="display:none;"></video>
        <canvas id="canvas" style="display:none;"></canvas>
        <button type="button" id="btnIniciarCamara" class="btn-secundario">Abrir c√°mara</button>
        <button type="button" id="btnTomarFoto" class="btn-principal" style="display:none;">Tomar foto</button>
        <img id="fotoPreview" alt="Foto de mascota" style="max-width:150px; margin-top:10px; border-radius:15px; display:none;" />
        <input type="hidden" name="Foto" id="fotoBase64" />
    </div>

    <button type="submit" class="btn-principal">Continuar</button>
</form>

    </div>

    <div class="imagen-bienvenida">
        <img src="~/img/mascotas-bienvenida.png" alt="Mascotas Bienvenida" />
    </div>
<script>
const especie = "@especie".trim().toLowerCase();
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const fotoPreview = document.getElementById("fotoPreview");
const btnIniciarCamara = document.getElementById("btnIniciarCamara");
const btnTomarFoto = document.getElementById("btnTomarFoto");
const fotoBase64 = document.getElementById("fotoBase64");
let stream = null;

// üîπ Abrir c√°mara
btnIniciarCamara.addEventListener("click", async () => {
  try {
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
    video.srcObject = stream;
    video.style.display = "block";
    btnIniciarCamara.style.display = "none";
    btnTomarFoto.style.display = "inline-block";
  } catch (err) {
    alert("No se pudo acceder a la c√°mara üòø. Revis√° los permisos del navegador.");
    console.error(err);
  }
});

// üîπ Tomar foto
btnTomarFoto.addEventListener("click", () => {
  const ctx = canvas.getContext("2d");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);
  const dataUrl = canvas.toDataURL("image/png");
  fotoBase64.value = dataUrl;
  fotoPreview.src = dataUrl;
  fotoPreview.style.display = "block";
  video.style.display = "none";
  btnTomarFoto.style.display = "none";
  if (stream) stream.getTracks().forEach(track => track.stop());
});

// ‚öôÔ∏è Resto del c√≥digo (raza, peso, edad)
const razasPorEspecie = {
  perro: ["Labrador Retriever","Golden Retriever","Bulldog","Beagle","Caniche","Caniche negro","Chihuahua","Pug","D√°lmata","Husky Siberiano","Cocker Spaniel","Pastor Alem√°n","Salchicha","Border Collie","Rottweiler","Boxer","Shih Tzu","Doberman","Jack Russell Terrier","Pitbull","Yorkshire Terrier","Malt√©s","Schnauzer","Akita Inu","San Bernardo","Pomerania","Weimaraner","Basset Hound","Galgo","Samoyedo","Otra raza"],
  gato: ["Persa","Siames","Maine Coon","Bengala","Ragdoll","British Shorthair","Bombay","Esfinge","Angora Turco","Siberiano","Abisinio","Azul Ruso","Scottish Fold","Bosque de Noruega","Birmano","Oriental de Pelo Corto","Himalayo","Savannah","Cornish Rex","Otra raza"],
  conejo: ["Mini Lop","Angora","Rex","Belier","Cabeza de Le√≥n","Otra raza"],
  ave: ["Cacat√∫a","Guacamayo","Periquito","Amazonas","Agapornis","Otra raza"],
  pez: ["Betta","Goldfish","Guppy","C√≠clido","Koi","Otra raza"],
  reptil: ["Iguana","Camale√≥n","Tortuga","Gecko","Boa","Serpiente del ma√≠z","Camale√≥n pantera","Tortuga acu√°tica","Gecko crestado","Varano","Drag√≥n Barbudo","Gecko Leopardo","Otra raza"],
  hamster: ["Sirio (Doradito)","Ruso","Campbell","Roborovski","Chino","Otra raza"],
  raton: ["Dom√©stico","Blanco de laboratorio","Fancy","Rata Dumbo","Rata Rex","Otra raza"]
};

const razaSelect = document.getElementById("Raza");
function llenarSelect(select, opciones) {
  select.innerHTML = "<option value=''>Seleccion√° una opci√≥n</option>";
  opciones.forEach(op => {
    const opt = document.createElement("option");
    opt.value = op;
    opt.textContent = op;
    select.appendChild(opt);
  });
}
llenarSelect(razaSelect, razasPorEspecie[especie] || razasPorEspecie.perro);

// ‚öñÔ∏è Peso y edad din√°micos
const pesoSlider = document.getElementById("Peso");
const pesoTexto = document.getElementById("pesoTexto");
const edadSlider = document.getElementById("Edad");
const edadTexto = document.getElementById("edadTexto");

const rangoPorEspeciePeso = { 
    perro:[0.1,80], gato:[0.1,15], conejo:[0.1,5], 
    ave:[0.1,3], pez:[0.1,2], reptil:[0.1,20], 
    hamster:[0.1,0.25], raton:[0.1,0.6] 
};
const rangoPeso = rangoPorEspeciePeso[especie] || [0.1,50];
pesoSlider.min = rangoPeso[0];
pesoSlider.max = rangoPeso[1];
pesoSlider.step = pesoSlider.max <= 1 ? 0.01 : 0.1;
pesoSlider.value = Math.max(rangoPeso[0], Math.min(rangoPeso[1], rangoPeso[1]/5));

// Funci√≥n para formatear el peso con precisi√≥n variable
function formatearPesoTexto(valor) {
    valor = parseFloat(valor);
    let decimales = valor <= 1 ? 2 : 1;
    return valor.toFixed(decimales).replace(".", ",") + " kg";
}

pesoTexto.textContent = formatearPesoTexto(pesoSlider.value);
pesoSlider.addEventListener("input", () => {
    pesoTexto.textContent = formatearPesoTexto(pesoSlider.value);
});

const rangoPorEspecieEdad = { perro:240, gato:240, conejo:144, ave:600, pez:120, reptil:720, hamster:36, raton:48 };
edadSlider.max = rangoPorEspecieEdad[especie] || 240;
edadSlider.value = 0;
edadTexto.textContent = "0 meses";
edadSlider.addEventListener("input",()=> {
  const m = parseInt(edadSlider.value);
  edadTexto.textContent = m < 12 ? `${m} ${m===1?"mes":"meses"}` : `${(m/12).toFixed(1)} ${(m/12===1)?"a√±o":"a√±os"}`;
});
</script>


</body>
</html>
<!-- ¬© 2025 Zooni Team
Licensed under CC BY-NC-ND 4.0 (https://creativecommons.org/licenses/by-nc-nd/4.0/)
No se permite la modificaci√≥n o uso comercial de este c√≥digo. -->
