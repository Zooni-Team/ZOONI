@model Zooni.Models.Mascota
@{
    ViewData["Title"] = "Registro Mascota - Detalles";
    Layout = null;

    var especie = ViewBag.MascotaEspecie?.ToString()?.ToLower() ?? "perro";
    var imagenSuperior = $"/img/cajas/{especie}caja.png";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"]</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

    <style>
        :root {
            --marron: #8B5E3C;
            --amarillo: #FFD85A;
            --verde: #3ac37d;
            --gris: #555;
            --gris-claro: #ccc;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }

        .titulo-principal {
            text-align: center;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .titulo-principal h1 {
            color: var(--marron);
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0;
        }

        .titulo-principal h2 {
            color: var(--gris);
            font-weight: 700;
            font-size: 1.15rem;
            margin: 0.3rem 0 1.5rem;
        }

        .contenedor {
            background: #fff;
            border-radius: 25px;
            box-shadow: 0px 8px 25px rgba(0, 0, 0, 0.08);
            padding: 2.2rem 2rem 2.5rem;
            text-align: center;
            width: 90%;
            max-width: 420px;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeUp 0.8s ease forwards;
        }

        @@keyframes fadeUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .titulo-con-flecha {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 0.5rem 0 1.3rem;
            width: 100%;
            flex-wrap: nowrap;
            white-space: nowrap;
        }

        .volver {
            background: none;
            border: none;
            padding: 0;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s ease;
            flex-shrink: 0;
            font-weight: normal;
            text-decoration: none;
        }

        .volver:focus {
            outline: none;
        }

        .volver:focus-visible {
            outline: 2px solid var(--verde);
            outline-offset: 2px;
            border-radius: 4px;
        }

        .volver img {
            width: 26px;
            height: 26px;
            display: block;
            filter: brightness(0) saturate(100%) invert(30%) sepia(25%) saturate(1500%) hue-rotate(15deg) brightness(0.85);
            transition: transform 0.2s ease, filter 0.2s ease;
            font-weight: normal;
            font-style: normal;
        }

        .volver:hover {
            transform: scale(1.1);
        }

        .volver:hover img {
            filter: brightness(0) saturate(100%) invert(65%) sepia(90%) saturate(500%) hue-rotate(100deg) brightness(1);
        }

        .subtitulo {
            color: var(--marron);
            font-size: 1.45rem;
            font-weight: 700;
            line-height: 1.3;
            margin: 0;
            white-space: nowrap;
            flex-shrink: 1;
        }

        img.mascota-caja {
            width: 180px;
            margin-bottom: 1.2rem;
            object-fit: contain;
            image-rendering: crisp-edges;
        }

        form {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 14px;
            width: 100%;
            z-index: 4;
        }

        select, input {
            width: 100%;
            max-width: 320px;
            padding: 12px 14px;
            border-radius: 20px;
            border: 1.8px solid var(--gris-claro);
            text-align: center;
            font-size: 15px;
            outline: none;
            transition: border 0.2s ease, box-shadow 0.2s ease;
            background: #fff;
        }

        select:focus, input:focus {
            border-color: var(--verde);
            box-shadow: 0 0 0 2px rgba(58, 195, 125, 0.25);
        }

        label {
            color: var(--marron);
            font-weight: 600;
            margin-top: 0.3rem;
            font-size: 0.95rem;
        }

        input[type="range"] {
            width: 100%;
            accent-color: var(--amarillo);
            cursor: pointer;
        }

        .edad-texto, .peso-texto {
            font-weight: 600;
            color: var(--marron);
            margin-top: 0.3rem;
            font-size: 0.95rem;
            text-align: center;
        }

        .btn-principal {
            background-color: var(--verde);
            color: #fff;
            border: none;
            border-radius: 25px;
            padding: 12px 40px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.25s ease;
            margin-top: 1.3rem;
            width: 100%;
            max-width: 320px;
            font-weight: 600;
        }

        .btn-principal:hover {
            background-color: #2fa567;
            transform: translateY(-2px);
        }

        .imagen-bienvenida {
            position: absolute;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            pointer-events: none;
            z-index: 1;
        }

        .imagen-bienvenida img {
            width: 100%;
            max-width: 900px;
            object-fit: cover;
        }

        @@media (max-width: 768px) {
            .contenedor { padding: 1.6rem; max-width: 370px; }
            .subtitulo { font-size: 1.3rem; }
        }

        @@media (max-width: 480px) {
            .contenedor { padding: 1.2rem; max-width: 340px; }
            .subtitulo { font-size: 1.15rem; }
            input { font-size: 14px; }
            .volver { 
                width: 32px;
                height: 32px;
                flex-shrink: 0;
            }
            .volver img {
                width: 24px;
                height: 24px;
            }
            .titulo-con-flecha {
                gap: 8px;
                padding: 0 4px;
            }
        }

        .edad-container, .peso-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 320px;
            margin-top: 0.8rem;
        }

        .foto-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 1.2rem;
            gap: 0.6rem;
        }

        .foto-label {
            color: var(--marron);
            font-weight: 600;
            font-size: 1.05rem;
        }

        .btn-secundario {
            background-color: #ffd85a;
            color: #5b4500;
            border: none;
            border-radius: 25px;
            padding: 10px 30px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            min-width: 160px;
            white-space: nowrap;
        }

        .btn-secundario:hover { background-color: #ffc93c; }
    </style>
</head>

<body>
    <div class="titulo-principal">
        <h1>Zooni</h1>
        <h2>춰Registrate!</h2>
    </div>

    <div class="contenedor">
        <div class="titulo-con-flecha">
            <button class="volver" onclick="window.location.href='/Registro/Registro2?volver=true'"><img src="~/img/icons/back-arrow-ios.svg" alt="Volver" /></button>
            <h3 class="subtitulo">Complet치 los datos de tu @ViewBag.MascotaEspecie 游</h3>
        </div>
        <img src="@imagenSuperior" alt="Mascota en caja" class="mascota-caja" />

        <form asp-action="Registro3Post" asp-controller="Registro" method="post">
    @Html.AntiForgeryToken()

    <!-- 游댳 Campo oculto para modo -->
<input type="hidden" name="modo" value="@(ViewBag.Modo != null ? ViewBag.Modo.ToString() : "normal")" />

    <!-- 游댳 Campo oculto para especie -->
    <input type="hidden" name="Especie" value="@ViewBag.MascotaEspecie" />

    <!-- SEXO -->
    <select name="Sexo" required>
        <option value="">Sexo</option>
        <option value="Macho">Macho</option>
        <option value="Hembra">Hembra</option>
    </select>

    <!-- RAZA -->
    <select id="Raza" name="Raza" required>
        <option value="">Seleccion치 una opci칩n</option>
    </select>

    <!-- PESO -->
    <div class="peso-container">
        <label for="Peso">Peso (kg)</label>
        <input type="range" id="Peso" name="Peso" min="0" max="50" step="0.1" value="5" />
        <div class="peso-texto" id="pesoTexto">5 kg</div>
    </div>

    <!-- EDAD -->
    <div class="edad-container">
        <label for="Edad">Edad</label>
        <input type="range" id="Edad" name="Edad" min="0" max="240" value="0" />
        <div class="edad-texto" id="edadTexto">0 meses</div>
    </div>

    <!-- FOTO -->
    <div class="foto-container">
        <label for="fotoMascota" class="foto-label">游닞 Agreg치 una foto de tu mascota</label>
        <input type="file" id="inputArchivo" accept="image/*" style="display:none;" />
        <video id="video" autoplay playsinline style="display:none;"></video>
        <canvas id="canvas" style="display:none;"></canvas>
        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; width:100%; max-width:320px;">
            <button type="button" id="btnSeleccionarArchivo" class="btn-secundario">游늬 Seleccionar archivo</button>
            <button type="button" id="btnIniciarCamara" class="btn-secundario">游닝 Abrir c치mara</button>
        </div>
        <button type="button" id="btnTomarFoto" class="btn-principal" style="display:none;">Tomar foto</button>
        <img id="fotoPreview" alt="Foto de mascota" style="max-width:150px; margin-top:10px; border-radius:15px; display:none;" />
        <input type="hidden" name="Foto" id="fotoBase64" />
    </div>

    <button type="submit" class="btn-principal">Continuar</button>
</form>

    </div>

    <div class="imagen-bienvenida">
        <img src="~/img/mascotas-bienvenida.png" alt="Mascotas Bienvenida" />
    </div>
<script>
const especie = "@especie".trim().toLowerCase();
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const fotoPreview = document.getElementById("fotoPreview");
const btnIniciarCamara = document.getElementById("btnIniciarCamara");
const btnSeleccionarArchivo = document.getElementById("btnSeleccionarArchivo");
const inputArchivo = document.getElementById("inputArchivo");
const btnTomarFoto = document.getElementById("btnTomarFoto");
const fotoBase64 = document.getElementById("fotoBase64");
let stream = null;

// 游댳 Seleccionar archivo
btnSeleccionarArchivo.addEventListener("click", () => {
  inputArchivo.click();
});

inputArchivo.addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (!file) return;
  
  // Validar que sea una imagen
  if (!file.type.startsWith("image/")) {
    alert("Por favor, seleccion치 un archivo de imagen 游");
    return;
  }
  
  // Validar tama침o (max 5MB)
  if (file.size > 5 * 1024 * 1024) {
    alert("El archivo es demasiado grande. Por favor, seleccion치 una imagen menor a 5MB 游");
    return;
  }
  
  const reader = new FileReader();
  reader.onload = (event) => {
    const dataUrl = event.target.result;
    fotoBase64.value = dataUrl;
    fotoPreview.src = dataUrl;
    fotoPreview.style.display = "block";
    
    // Ocultar botones de c치mara si est치n activos
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
      stream = null;
    }
    video.style.display = "none";
    btnTomarFoto.style.display = "none";
    btnIniciarCamara.style.display = "inline-block";
    btnSeleccionarArchivo.style.display = "inline-block";
  };
  reader.readAsDataURL(file);
});

// 游댳 Abrir c치mara
btnIniciarCamara.addEventListener("click", async () => {
  try {
    // Detener stream anterior si existe
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
    }
    
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
    video.srcObject = stream;
    video.style.display = "block";
    btnIniciarCamara.style.display = "none";
    btnSeleccionarArchivo.style.display = "none";
    btnTomarFoto.style.display = "inline-block";
    
    // Limpiar preview de archivo si existe
    fotoPreview.style.display = "none";
    fotoBase64.value = "";
    inputArchivo.value = "";
  } catch (err) {
    alert("No se pudo acceder a la c치mara 游. Revis치 los permisos del navegador.");
    console.error(err);
  }
});

// 游댳 Tomar foto
btnTomarFoto.addEventListener("click", () => {
  const ctx = canvas.getContext("2d");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);
  const dataUrl = canvas.toDataURL("image/png");
  fotoBase64.value = dataUrl;
  fotoPreview.src = dataUrl;
  fotoPreview.style.display = "block";
  video.style.display = "none";
  btnTomarFoto.style.display = "none";
  if (stream) stream.getTracks().forEach(track => track.stop());
  stream = null;
  btnIniciarCamara.style.display = "inline-block";
  btnSeleccionarArchivo.style.display = "inline-block";
});

// 丘뙖잺 Resto del c칩digo (raza, peso, edad)
const razasPorEspecie = {
  perro: ["Labrador Retriever","Golden Retriever","Bulldog","Beagle","Caniche","Caniche negro","Chihuahua","Pug","D치lmata","Husky Siberiano","Cocker Spaniel","Pastor Alem치n","Salchicha","Border Collie","Rottweiler","Boxer","Shih Tzu","Doberman","Jack Russell Terrier","Pitbull","Yorkshire Terrier","Malt칠s","Schnauzer","Akita Inu","San Bernardo","Pomerania","Weimaraner","Basset Hound","Galgo","Samoyedo","Otra raza"],
  gato: ["Persa","Siames","Maine Coon","Bengala","Ragdoll","British Shorthair","Bombay","Esfinge","Angora Turco","Siberiano","Abisinio","Azul Ruso","Scottish Fold","Bosque de Noruega","Birmano","Oriental de Pelo Corto","Himalayo","Savannah","Cornish Rex","Otra raza"],
  conejo: ["Mini Lop","Angora","Rex","Belier","Cabeza de Le칩n","Otra raza"],
  ave: ["Cacat칰a","Guacamayo","Periquito","Amazonas","Agapornis","Otra raza"],
  pez: ["Betta","Goldfish","Guppy","C칤clido","Koi","Otra raza"],
  reptil: ["Iguana","Camale칩n","Tortuga","Gecko","Boa","Serpiente del ma칤z","Camale칩n pantera","Tortuga acu치tica","Gecko crestado","Varano","Drag칩n Barbudo","Gecko Leopardo","Otra raza"],
  hamster: ["Sirio (Doradito)","Ruso","Campbell","Roborovski","Chino","Otra raza"],
  raton: ["Dom칠stico","Blanco de laboratorio","Fancy","Rata Dumbo","Rata Rex","Otra raza"]
};

const razaSelect = document.getElementById("Raza");
function llenarSelect(select, opciones) {
  select.innerHTML = "<option value=''>Seleccion치 una opci칩n</option>";
  opciones.forEach(op => {
    const opt = document.createElement("option");
    opt.value = op;
    opt.textContent = op;
    select.appendChild(opt);
  });
}
llenarSelect(razaSelect, razasPorEspecie[especie] || razasPorEspecie.perro);

// 丘뒲잺 Peso y edad din치micos
const pesoSlider = document.getElementById("Peso");
const pesoTexto = document.getElementById("pesoTexto");
const edadSlider = document.getElementById("Edad");
const edadTexto = document.getElementById("edadTexto");

const rangoPorEspeciePeso = { 
    perro:[0.1,80], gato:[0.1,15], conejo:[0.1,5], 
    ave:[0.1,3], pez:[0.1,2], reptil:[0.1,20], 
    hamster:[0.1,0.25], raton:[0.1,0.6] 
};
const rangoPeso = rangoPorEspeciePeso[especie] || [0.1,50];
pesoSlider.min = rangoPeso[0];
pesoSlider.max = rangoPeso[1];
pesoSlider.step = pesoSlider.max <= 1 ? 0.01 : 0.1;
pesoSlider.value = Math.max(rangoPeso[0], Math.min(rangoPeso[1], rangoPeso[1]/5));

// Funci칩n para formatear el peso con precisi칩n variable
function formatearPesoTexto(valor) {
    valor = parseFloat(valor);
    let decimales = valor <= 1 ? 2 : 1;
    return valor.toFixed(decimales).replace(".", ",") + " kg";
}

pesoTexto.textContent = formatearPesoTexto(pesoSlider.value);
pesoSlider.addEventListener("input", () => {
    pesoTexto.textContent = formatearPesoTexto(pesoSlider.value);
});

const rangoPorEspecieEdad = { perro:240, gato:240, conejo:144, ave:600, pez:120, reptil:720, hamster:36, raton:48 };
edadSlider.max = rangoPorEspecieEdad[especie] || 240;
edadSlider.value = 0;
edadTexto.textContent = "0 meses";
edadSlider.addEventListener("input",()=> {
  const m = parseInt(edadSlider.value);
  edadTexto.textContent = m < 12 ? `${m} ${m===1?"mes":"meses"}` : `${(m/12).toFixed(1)} ${(m/12===1)?"a침o":"a침os"}`;
});
</script>


</body>
</html>
<!-- 춸 2025 Zooni Team
Licensed under CC BY-NC-ND 4.0 (https://creativecommons.org/licenses/by-nc-nd/4.0/)
No se permite la modificaci칩n o uso comercial de este c칩digo. -->