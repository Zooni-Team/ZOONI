@using Zooni.Models
@{
    ViewData["Title"] = "Perfil - Zooni";
    Layout = null;
    var tema = ViewBag.Tema ?? Context.Session.GetString("Tema") ?? "claro";
    var mascotas = ViewBag.Mascotas as List<Mascota> ?? new List<Mascota>();
    var publicaciones = ViewBag.Publicaciones as List<Publicacion> ?? new List<Publicacion>();
    var historias = ViewBag.Historias as List<Historia> ?? new List<Historia>();
    var historiasDestacadas = ViewBag.HistoriasDestacadas as List<HistoriaDestacada> ?? new List<HistoriaDestacada>();
    var amigos = ViewBag.Amigos as List<object> ?? new List<object>();
    var esMiPerfil = ViewBag.EsMiPerfil ?? false;
    var perfilId = ViewBag.PerfilId ?? 0;
    var esAmigo = ViewBag.EsAmigo ?? false;
    var tieneSolicitud = ViewBag.TieneSolicitud ?? false;
    var cantidadPublicaciones = ViewBag.CantidadPublicaciones ?? 0;
    var cantidadSeguidores = ViewBag.CantidadSeguidores ?? 0;
    var cantidadSiguiendo = ViewBag.CantidadSiguiendo ?? 0;
    
    // ‚úÖ Manejo seguro y limpieza de valores
    string LimpiarTexto(string texto)
    {
        if (string.IsNullOrWhiteSpace(texto)) return "";
        return System.Text.RegularExpressions.Regex.Replace(
            texto.Trim(), 
            @"[\x00-\x1F\x7F-\x9F]", 
            ""
        ).Replace("??", "").Replace("?", "");
    }
    
    var nombreCompletoRaw = ViewBag.Nombre?.ToString() ?? "Usuario";
    var nombreCompleto = LimpiarTexto(nombreCompletoRaw);
    if (string.IsNullOrWhiteSpace(nombreCompleto) || nombreCompleto.Length < 2)
        nombreCompleto = "Usuario";
    
    var paisRaw = ViewBag.Pais?.ToString() ?? "Argentina";
    var pais = LimpiarTexto(paisRaw);
    if (string.IsNullOrWhiteSpace(pais))
        pais = "Argentina";
    
    var descripcionRaw = ViewBag.Descripcion?.ToString() ?? "Amante de los animales";
    var descripcion = LimpiarTexto(descripcionRaw);
    if (string.IsNullOrWhiteSpace(descripcion))
        descripcion = "Amante de los animales";
    
    var fotoPerfilRaw = ViewBag.FotoPerfil?.ToString() ?? "/img/perfil/default.png";
    var fotoPerfil = LimpiarTexto(fotoPerfilRaw);
    if (string.IsNullOrWhiteSpace(fotoPerfil) || !fotoPerfil.StartsWith("/"))
        fotoPerfil = "/img/perfil/default.png";
    
    // Separar nombre y apellido de forma segura
    var nombreUsuarioRaw = ViewBag.NombreUsuario?.ToString() ?? "";
    var apellidoUsuarioRaw = ViewBag.ApellidoUsuario?.ToString() ?? "";
    
    var nombreUsuario = LimpiarTexto(nombreUsuarioRaw);
    var apellidoUsuario = LimpiarTexto(apellidoUsuarioRaw);
    
    // Si no hay nombre/apellido separados, intentar separar del nombre completo
    if (string.IsNullOrWhiteSpace(nombreUsuario) && !string.IsNullOrWhiteSpace(nombreCompleto))
    {
        var partesNombre = nombreCompleto.Split(new[] { ' ' }, StringSplitOptions.RemoveEmptyEntries);
        nombreUsuario = partesNombre.Length > 0 ? LimpiarTexto(partesNombre[0]) : "";
        apellidoUsuario = partesNombre.Length > 1 ? LimpiarTexto(partesNombre[1]) : "";
    }
    
    if (string.IsNullOrWhiteSpace(nombreUsuario))
        nombreUsuario = "";
    if (string.IsNullOrWhiteSpace(apellidoUsuario))
        apellidoUsuario = "";
}

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>@ViewData["Title"]</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
<script src="~/lib/country-state-city/country-state-city.umd.min.js"></script>
<style>
:root {
  --verde: #39b77c;
  --amarillo: #FFD85A;
  --marron: #3c2a1b;
  --fondo-claro: #f9f9f8;
  --fondo-oscuro: #121212;
  --texto-claro: #3c2a1b;
  --texto-oscuro: #ffffff;
  --card-claro: rgba(255,255,255,0.95);
  --card-oscuro: rgba(30,30,30,0.95);
  --rojo: #ff6b6b;
  --crema: #fffaf4;
}

* {
  box-sizing: border-box;
}

html, body {
  margin: 0; padding: 0;
  width: 100%; min-height: 100vh;
  font-family: 'Poppins', sans-serif;
  transition: background .4s ease, color .4s ease;
  overflow-x: hidden;
}

body.tema-claro {
  background: var(--fondo-claro) url('/img/fondos/consultorio.jpg') center/cover fixed no-repeat;
  color: var(--texto-claro);
}

body.tema-oscuro {
  background: var(--fondo-oscuro) url('/img/fondos/consultorio.jpg') center/cover fixed no-repeat;
  background-color: rgba(0, 0, 0, 0.7);
  background-blend-mode: overlay;
  color: var(--texto-oscuro);
}

header { 
  position: fixed; 
  top: 15px; 
  left: 20px; 
  z-index: 10; 
}
.menu-icon { 
  width: 38px; 
  cursor: pointer; 
  transition: transform .25s ease, filter .3s ease;
  filter: brightness(0);
}
body.tema-oscuro .menu-icon {
  filter: brightness(0) invert(1);
}
.menu-icon:hover { transform: scale(1.1); }

.menu-lateral {
  position: fixed;
  top: 0; left: 0;
  transform: translateX(-100%);
  width: 240px; height: 100%;
  backdrop-filter: blur(16px);
  box-shadow: 4px 0 18px rgba(0,0,0,0.15);
  display: flex; flex-direction: column;
  padding: 2.5rem 1.2rem;
  gap: 1rem;
  transition: transform 0.35s ease, background .4s ease, color .4s ease;
  border-top-right-radius: 18px;
  border-bottom-right-radius: 18px;
  z-index: 9999;
}
body.tema-claro .menu-lateral {
  background: #ffffff;
}
body.tema-oscuro .menu-lateral {
  background: rgba(30,30,30,0.97);
  box-shadow: 4px 0 18px rgba(0,0,0,0.5);
}
.menu-lateral.abierto { transform: translateX(0); }
.menu-lateral a {
  text-decoration: none;
  font-weight: 600;
  font-size: 1.1rem;
  padding: 0.6rem 0.8rem;
  border-radius: 12px;
  transition: all .25s ease;
  color: inherit;
}
body.tema-claro .menu-lateral a {
  color: var(--marron);
}
body.tema-oscuro .menu-lateral a {
  color: #ffffff;
}
body.tema-claro .menu-lateral a:hover {
  background: var(--amarillo);
  color: #3c2a00;
}
body.tema-oscuro .menu-lateral a:hover {
  background: var(--verde);
  color: #ffffff;
}
.cerrar-menu {
  align-self: flex-end;
  font-size: 1.6rem;
  cursor: pointer;
  margin-bottom: 1.2rem;
  transition: transform 0.2s ease, color .3s ease;
  color: inherit;
}
body.tema-claro .cerrar-menu {
  color: var(--marron);
}
body.tema-oscuro .cerrar-menu {
  color: #ffffff;
}
.cerrar-menu:hover {
  transform: scale(1.2);
}
.overlay {
  position: fixed; top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.25);
  opacity:0; pointer-events:none;
  transition:opacity .3s ease;
  z-index: 8;
}
.overlay.activo { opacity:1; pointer-events:auto; }

main {
  margin-top: 90px;
  width: 100%;
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
  display: flex;
  flex-direction: column;
  padding: 0 20px 60px 20px;
  gap: 20px;
}

h1 {
  text-align:center;
  margin: 0 0 30px 0;
  font-size:1.9rem;
  font-weight:700;
  color: inherit;
}

section {
  border-radius: 28px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  width: 100%;
  padding: 2rem 1.8rem;
  margin-bottom: 25px;
  backdrop-filter: blur(10px);
  transition: background .4s ease, box-shadow .4s ease;
}
body.tema-claro section {
  background: var(--card-claro);
}
body.tema-oscuro section {
  background: var(--card-oscuro);
  box-shadow: 0 6px 18px rgba(0,0,0,0.5);
}

h2 { 
  font-size:1.3rem; 
  margin: 0 0 20px 0; 
  font-weight:600; 
  color: inherit;
}

.avatar-usuario {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 30px;
  position: relative;
  padding-top: 10px;
}
.avatar-usuario img {
  width: 140px; 
  height: 140px;
  border-radius: 50%;
  border: 4px solid var(--verde);
  object-fit: cover;
  margin-bottom: 15px;
  background: white;
  cursor: pointer;
  transition: transform .3s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.avatar-usuario img:hover {
  transform: scale(1.05);
}
.cambiar-foto {
  position: absolute;
  bottom: 15px;
  right: calc(50% - 70px);
  background: var(--verde);
  color: white;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  cursor: pointer;
  font-size: 1.3rem;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  transition: all .3s ease;
  z-index: 2;
}
.cambiar-foto:hover {
  background: #2fa76b;
  transform: scale(1.1);
}
.nombre { 
  font-size: 1.4rem; 
  font-weight: 700; 
  color: inherit;
  margin-bottom: 8px;
  text-align: center;
}
.pais { 
  color: inherit; 
  font-weight: 500; 
  margin-bottom: 0; 
  opacity: 0.8;
  font-size: 1rem;
}

.form-group {
  margin-bottom: 20px;
}
.form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 8px;
  color: inherit;
  font-size: 0.95rem;
}
.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid rgba(0,0,0,0.1);
  border-radius: 12px;
  font-family: 'Poppins', sans-serif;
  font-size: 1rem;
  transition: all .3s ease;
  box-sizing: border-box;
}
body.tema-claro .form-group input,
body.tema-claro .form-group textarea,
body.tema-claro .form-group select {
  background: white;
  color: var(--texto-claro);
  border-color: rgba(0,0,0,0.1);
}
body.tema-oscuro .form-group input,
body.tema-oscuro .form-group textarea,
body.tema-oscuro .form-group select {
  background: rgba(40,40,40,0.8);
  color: var(--texto-oscuro);
  border-color: rgba(255,255,255,0.1);
}
.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--verde);
  box-shadow: 0 0 0 3px rgba(57, 195, 125, 0.1);
}
.form-group textarea {
  resize: vertical;
  min-height: 100px;
}
.form-group select {
  cursor: pointer;
}
.form-group select option {
  padding: 8px;
}

.descripcion-vista {
  padding: 15px 18px;
  border-radius: 12px;
  min-height: 80px;
  line-height: 1.6;
  color: inherit;
}
body.tema-claro .descripcion-vista {
  background: rgba(0,0,0,0.03);
}
body.tema-oscuro .descripcion-vista {
  background: rgba(255,255,255,0.05);
}

.mascotas-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 15px;
  margin-top: 15px;
  width: 100%;
}
.mascota {
  background: var(--crema);
  border-radius: 16px;
  padding: 12px;
  text-align: center;
  cursor: pointer;
  transition: all .3s ease;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  border: 2px solid transparent;
  min-height: 120px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
body.tema-oscuro .mascota {
  background: rgba(40,40,40,0.8);
}
.mascota:hover { 
  transform: translateY(-3px) scale(1.02); 
  background: var(--amarillo);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
  border-color: var(--verde);
}
body.tema-oscuro .mascota:hover {
  background: var(--amarillo);
}
.mascota img {
  width: 75px; 
  height: 75px;
  border-radius: 50%;
  object-fit: cover;
  background: white;
  border: 2px solid var(--verde);
  margin-bottom: 8px;
  display: block;
}
.mascota p {
  margin: 0;
  font-size: 0.9rem;
  font-weight: 600;
  color: inherit;
  word-break: break-word;
  line-height: 1.2;
}

.btn {
  background: var(--verde);
  color: white;
  font-weight: 600;
  padding: 14px 24px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all .3s ease;
  width: 100%;
  font-size: 1rem;
  margin-top: 10px;
}
.btn:hover { 
  background: #2fa76b; 
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(57, 195, 125, 0.3);
}
.btn-secondary {
  background: #888;
}
.btn-secondary:hover {
  background: #666;
}

.modo-edicion {
  display: none;
}
.modo-edicion.activo {
  display: block;
}
.modo-vista {
  display: block;
}
.modo-vista.oculto {
  display: none;
}

.editar-btn {
  background: var(--amarillo);
  color: #3a2b00;
  padding: 12px 20px;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all .3s ease;
  width: 100%;
  margin-top: 15px;
  font-size: 1rem;
}
.editar-btn:hover {
  background: #FFC93C;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 216, 90, 0.3);
}

.mensaje {
  padding: 14px 18px;
  border-radius: 12px;
  margin-bottom: 20px;
  font-size: 0.95rem;
  text-align: center;
  font-weight: 500;
}
.mensaje-exito {
  background: rgba(57, 195, 125, 0.2);
  color: #2d5a3d;
  border: 1px solid var(--verde);
}
body.tema-oscuro .mensaje-exito {
  background: rgba(57, 195, 125, 0.3);
  color: #a8e6c7;
}
.mensaje-error {
  background: rgba(255, 107, 107, 0.2);
  color: #8b0000;
  border: 1px solid var(--rojo);
}
body.tema-oscuro .mensaje-error {
  background: rgba(255, 107, 107, 0.3);
  color: #ffcccc;
}

input[type="file"] {
  display: none;
}

.mensaje-vacio {
  text-align: center;
  padding: 30px 20px;
  opacity: 0.7;
  color: inherit;
  font-size: 0.95rem;
}

@@media (max-width: 600px) {
  main {
    padding: 0 15px 60px 15px;
  }
  section {
    padding: 1.5rem 1.3rem;
  }
  .avatar-usuario img { 
    width: 120px; 
    height: 120px; 
  }
  .cambiar-foto {
    right: calc(50% - 60px);
    width: 36px;
    height: 36px;
    font-size: 1.2rem;
  }
  .mascotas-grid {
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: 12px;
  }
  .mascota {
    min-height: 110px;
    padding: 10px;
  }
  .mascota img {
    width: 65px;
    height: 65px;
  }
}

@@media (max-width: 480px) {
  h1 {
    font-size: 1.6rem;
  }
  section {
    padding: 1.3rem 1.1rem;
  }
  .avatar-usuario img { 
    width: 100px; 
    height: 100px; 
  }
  .cambiar-foto {
    right: calc(50% - 50px);
    width: 32px;
    height: 32px;
    font-size: 1rem;
  }
  .mascotas-grid {
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  }
}

/* ========== ESTILOS TIPO INSTAGRAM ========== */
.perfil-header {
  display: flex;
  gap: 30px;
  padding: 30px 20px;
  border-bottom: 1px solid rgba(0,0,0,0.1);
  margin-bottom: 20px;
  flex-wrap: wrap;
  background: var(--card-claro);
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
body.tema-oscuro .perfil-header {
  border-bottom-color: rgba(255,255,255,0.1);
  background: var(--card-oscuro);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.perfil-foto-container {
  position: relative;
  flex-shrink: 0;
  align-self: flex-start;
}
.perfil-foto {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid var(--verde);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  cursor: pointer;
  transition: transform 0.3s ease;
}
.perfil-foto:hover {
  transform: scale(1.05);
}
.btn-cambiar-foto {
  position: absolute;
  bottom: 5px;
  right: 5px;
  background: var(--verde);
  color: white;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  cursor: pointer;
  font-size: 1.4rem;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
  z-index: 2;
}
.btn-cambiar-foto:hover {
  background: #2fa76b;
  transform: scale(1.1);
}

.perfil-info {
  flex: 1;
  min-width: 250px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}
.perfil-nombre-acciones {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 0;
  flex-wrap: wrap;
}
.perfil-username {
  font-size: 1.8rem;
  font-weight: 300;
  margin: 0;
  color: inherit;
}
.btn-perfil {
  padding: 10px 18px;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 10px;
  background: transparent;
  color: inherit;
  font-weight: 600;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.2s;
  white-space: nowrap;
}
body.tema-oscuro .btn-perfil {
  border-color: rgba(255,255,255,0.2);
}
.btn-perfil:hover {
  background: rgba(0,0,0,0.05);
  transform: translateY(-1px);
}
body.tema-oscuro .btn-perfil:hover {
  background: rgba(255,255,255,0.05);
}
.btn-editar {
  background: var(--verde);
  color: white;
  border-color: var(--verde);
}
.btn-editar:hover {
  background: #2fa76b;
}
.btn-amigo {
  background: var(--verde);
  color: white;
  border-color: var(--verde);
}
.btn-agregar {
  background: var(--verde);
  color: white;
  border-color: var(--verde);
}
.btn-pendiente {
  opacity: 0.6;
  cursor: not-allowed;
}

.perfil-stats {
  display: flex;
  gap: 40px;
  margin-bottom: 0;
  padding: 15px 0;
  border-top: 1px solid rgba(0,0,0,0.1);
  border-bottom: 1px solid rgba(0,0,0,0.1);
}
body.tema-oscuro .perfil-stats {
  border-top-color: rgba(255,255,255,0.1);
  border-bottom-color: rgba(255,255,255,0.1);
}
.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: transform 0.2s;
}
.stat-item:hover {
  transform: scale(1.05);
}
.stat-item strong {
  font-size: 1.3rem;
  font-weight: 700;
  color: inherit;
}
.stat-item span {
  font-size: 0.85rem;
  opacity: 0.7;
  text-transform: lowercase;
}

.perfil-descripcion {
  margin-top: 0;
}
.perfil-descripcion strong {
  display: block;
  margin-bottom: 8px;
  font-size: 1.1rem;
  font-weight: 600;
}
.perfil-descripcion p {
  margin: 8px 0;
  line-height: 1.6;
  font-size: 0.95rem;
}
.perfil-ubicacion {
  display: block;
  margin-top: 8px;
  font-size: 0.9rem;
  opacity: 0.7;
  font-weight: 500;
}

.historias-section {
  margin-bottom: 30px;
  padding: 20px 0;
  border-bottom: 1px solid rgba(0,0,0,0.1);
}
body.tema-oscuro .historias-section {
  border-bottom-color: rgba(255,255,255,0.1);
}
.historias-destacadas,
.historias-activas {
  display: flex;
  gap: 15px;
  overflow-x: auto;
  padding: 10px 0;
  scrollbar-width: thin;
}
.historia-destacada,
.historia-item {
  flex-shrink: 0;
  text-align: center;
  cursor: pointer;
}
.historia-destacada-imagen,
.historia-imagen {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 3px solid var(--verde);
  overflow: hidden;
  margin-bottom: 5px;
}
.historia-destacada-imagen img,
.historia-imagen img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.historia-destacada-titulo,
.historia-usuario {
  font-size: 0.75rem;
  display: block;
  max-width: 80px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.amigos-section {
  margin-bottom: 30px;
}
.amigos-section h3 {
  font-size: 1.1rem;
  margin-bottom: 15px;
}
.amigos-grid {
  display: flex;
  gap: 15px;
  overflow-x: auto;
  padding: 10px 0;
}
.amigo-item {
  flex-shrink: 0;
  text-align: center;
  cursor: pointer;
}
.amigo-item img {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--verde);
  margin-bottom: 5px;
}
.amigo-item span {
  display: block;
  font-size: 0.75rem;
  max-width: 60px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.publicaciones-tabs {
  display: flex;
  justify-content: center;
  gap: 0;
  border-top: 1px solid rgba(0,0,0,0.1);
  margin-bottom: 20px;
}
body.tema-oscuro .publicaciones-tabs {
  border-top-color: rgba(255,255,255,0.1);
}
.tab-btn {
  flex: 1;
  padding: 15px;
  border: none;
  background: transparent;
  color: inherit;
  font-size: 1.2rem;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  opacity: 0.5;
  transition: all 0.2s;
}
.tab-btn.active {
  opacity: 1;
  border-bottom-color: var(--verde);
}

.publicaciones-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 2px;
  margin-bottom: 30px;
}
.publicacion-item {
  position: relative;
  aspect-ratio: 1;
  overflow: hidden;
  cursor: pointer;
  background: rgba(0,0,0,0.1);
}
.publicacion-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s;
}
.publicacion-item:hover img {
  transform: scale(1.1);
}
.publicacion-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  opacity: 0;
  transition: opacity 0.3s;
  color: white;
  font-weight: 600;
}
.publicacion-item:hover .publicacion-overlay {
  opacity: 1;
}
.publicacion-anclada {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 5px 8px;
  border-radius: 5px;
  font-size: 0.8rem;
  z-index: 2;
}

.sin-publicaciones {
  text-align: center;
  padding: 60px 20px;
  color: inherit;
  opacity: 0.6;
}

.modal-publicacion {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.8);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.modal-content {
  background: var(--card-claro);
  border-radius: 12px;
  max-width: 900px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
}
body.tema-oscuro .modal-content {
  background: var(--card-oscuro);
}
.modal-close {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0,0,0,0.5);
  color: white;
  border: none;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  cursor: pointer;
  font-size: 1.2rem;
  z-index: 10;
}

@@media (max-width: 768px) {
  main {
    padding: 0 15px 60px 15px;
  }
  .perfil-header {
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 20px 15px;
    gap: 20px;
  }
  .perfil-foto-container {
    align-self: center;
  }
  .perfil-foto {
    width: 120px;
    height: 120px;
  }
  .btn-cambiar-foto {
    width: 36px;
    height: 36px;
    font-size: 1.2rem;
  }
  .perfil-info {
    width: 100%;
    align-items: center;
  }
  .perfil-nombre-acciones {
    justify-content: center;
    flex-direction: column;
    width: 100%;
  }
  .btn-perfil {
    width: 100%;
    max-width: 200px;
  }
  .perfil-stats {
    justify-content: space-around;
    gap: 20px;
    width: 100%;
  }
  .perfil-descripcion {
    text-align: center;
    width: 100%;
  }
  .publicaciones-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 1px;
  }
  .historias-section {
    padding: 15px 0;
  }
  .amigos-section {
    padding: 15px 0;
  }
  .modal-content {
    max-width: 95%;
    margin: 10px;
  }
}
</style>
</head>

<body class="tema-@tema">
<header>
  <img src="/img/icons/hamburger.png" alt="Men√∫" class="menu-icon" id="abrirMenu" />
</header>

<div class="menu-lateral" id="menuLateral">
    <div class="cerrar-menu" id="cerrarMenu">‚úñ</div>
    <a href="/Home/Index">üè† Inicio</a>
    <a href="/Home/Comunidad">üë• Comunidad</a>
    <a href="/Home/BuscarProveedores">üîç Buscar Proveedores</a>
    <a href="/Home/Planificador">üìÖ Planificador de Servicios</a>
    <a href="/Marketplace">üõí Marketplace</a>
    <a href="/Home/FichaMedica">üíâ Ficha m√©dica</a>
    <a href="/Home/Calendario">üìÖ Calendario</a>
    <a href="/Chat/ChatZooni">üí¨ ChatBot</a>
    <a href="/Home/Closet">üëï Closet</a>
    <a href="/Home/Perfil">üë§ Perfil</a>
    <a href="/Home/Configuracion">‚öôÔ∏è Configuraci√≥n</a>
    <a href="/Auth/Logout" style="color:red;">üö™ Cerrar sesi√≥n</a>
</div>
<div class="overlay" id="overlay"></div>

<main>
  <div class="perfil-header">
    <div class="perfil-foto-container">
      <img src="@fotoPerfil" alt="@nombreCompleto" class="perfil-foto" onerror="this.src='/img/perfil/default.png'" />
      @if (esMiPerfil)
      {
        <button class="btn-cambiar-foto" onclick="abrirModalEditarPerfil()" title="Cambiar foto">+</button>
        <input type="file" id="fotoInput" accept="image/*" style="display:none;" />
      }
    </div>
    <div class="perfil-info">
      <div class="perfil-nombre-acciones">
        <h1 class="perfil-username">@nombreCompleto</h1>
        @if (esMiPerfil)
        {
          <button class="btn-perfil btn-editar" onclick="abrirModalEditarPerfil()">Editar perfil</button>
          <button class="btn-perfil btn-config" onclick="document.getElementById('menuLateral').classList.add('abierto'); document.getElementById('overlay').classList.add('activo');">Config</button>
          <button class="btn-perfil btn-nueva-publicacion" onclick="abrirModalNuevaPublicacion()" style="background: var(--amarillo); color: #3a2b00;">Nueva publicaci√≥n</button>
        }
        else
        {
          if (esAmigo)
          {
            <button class="btn-perfil btn-amigo" onclick="eliminarAmigo(@perfilId)">Amigo ‚úì</button>
          }
          else if (tieneSolicitud)
          {
            <button class="btn-perfil btn-pendiente" disabled>Solicitud pendiente</button>
          }
          else
          {
            <button class="btn-perfil btn-agregar" onclick="agregarAmigo(@perfilId)">Agregar</button>
          }
          <button class="btn-perfil btn-mensaje" onclick="abrirChat(@perfilId)">Mensaje</button>
        }
      </div>
      <div class="perfil-stats">
        <div class="stat-item">
          <strong>@cantidadPublicaciones</strong>
          <span>publicaciones</span>
        </div>
        <div class="stat-item" onclick="@(esMiPerfil ? "location.href='/Home/Comunidad'" : "")" style="@(esMiPerfil ? "cursor:pointer;" : "")">
          <strong>@cantidadSeguidores</strong>
          <span>seguidores</span>
        </div>
        <div class="stat-item" onclick="@(esMiPerfil ? "location.href='/Home/Comunidad'" : "")" style="@(esMiPerfil ? "cursor:pointer;" : "")">
          <strong>@cantidadSiguiendo</strong>
          <span>siguiendo</span>
        </div>
      </div>
      <div class="perfil-descripcion">
        <strong>@nombreCompleto</strong>
        <p>@descripcion</p>
        <span class="perfil-ubicacion">@pais</span>
      </div>
    </div>
  </div>

  @if (TempData["Exito"] != null)
  {
    <div class="mensaje mensaje-exito">@TempData["Exito"]</div>
  }
  @if (TempData["Error"] != null)
  {
    <div class="mensaje mensaje-error">@TempData["Error"]</div>
  }

  <!-- Historias -->
  @if (historias.Count > 0 || historiasDestacadas.Count > 0)
  {
    <div class="historias-section">
      @if (historiasDestacadas.Count > 0)
      {
        <div class="historias-destacadas">
          @foreach (var destacada in historiasDestacadas)
          {
            <div class="historia-destacada" onclick="verHistoriaDestacada(@destacada.Id_Historia)">
              <div class="historia-destacada-imagen">
                <img src="@destacada.ImagenUrl" alt="@destacada.Titulo" onerror="this.src='/img/mascotas/default.png'" />
              </div>
              <span class="historia-destacada-titulo">@(destacada.Titulo ?? "Destacada")</span>
            </div>
          }
        </div>
      }
      @if (historias.Count > 0)
      {
        <div class="historias-activas">
          @foreach (var historia in historias)
          {
            <div class="historia-item" onclick="verHistoria(@historia.Id_Historia)">
              <div class="historia-imagen">
                <img src="@historia.ImagenUrl" alt="Historia" onerror="this.src='/img/mascotas/default.png'" />
              </div>
              <span class="historia-usuario">@(historia.NombreMascota ?? historia.NombreUsuario)</span>
            </div>
          }
        </div>
      }
    </div>
  }

  <!-- Amigos -->
  @if (amigos.Count > 0)
  {
    <div class="amigos-section">
      <h3>Amigos</h3>
      <div class="amigos-grid">
        @foreach (var amigo in amigos)
        {
          <div class="amigo-item" onclick="location.href='/Home/Perfil?id=@(amigo.GetType().GetProperty("Id")?.GetValue(amigo))'">
            <img src="@(amigo.GetType().GetProperty("FotoPerfil")?.GetValue(amigo) ?? "/img/perfil/default.png")" alt="@(amigo.GetType().GetProperty("Nombre")?.GetValue(amigo))" onerror="this.src='/img/perfil/default.png'" />
            <span>@(amigo.GetType().GetProperty("Nombre")?.GetValue(amigo))</span>
          </div>
        }
      </div>
    </div>
  }

  <!-- Publicaciones -->
  <div class="publicaciones-tabs">
    <button class="tab-btn active" onclick="mostrarPublicaciones('grid')">Grid</button>
    <button class="tab-btn" onclick="mostrarPublicaciones('list')">Lista</button>
  </div>

  <div class="publicaciones-grid" id="publicacionesGrid">
    @if (publicaciones.Count > 0)
    {
      @foreach (var pub in publicaciones)
      {
        <div class="publicacion-item" onclick="abrirPublicacion(@pub.Id_Publicacion)">
          <img src="@(pub.ImagenUrl ?? "/img/mascotas/default.png")" alt="Publicaci√≥n" onerror="this.src='/img/mascotas/default.png'" />
          @if (pub.Anclada)
          {
            <div class="publicacion-anclada">Fijada</div>
          }
          <div class="publicacion-overlay">
            <span>Me gusta: @pub.CantidadLikes</span>
            <span>Comentarios: @pub.CantidadComentarios</span>
          </div>
        </div>
      }
    }
    else
    {
      <div class="sin-publicaciones">
        <p>@(esMiPerfil ? "A√∫n no ten√©s publicaciones. ¬°Compart√≠ algo!" : "Este usuario a√∫n no tiene publicaciones")</p>
      </div>
    }
  </div>

  <!-- Modal de Publicaci√≥n -->
  <div class="modal-publicacion" id="modalPublicacion" style="display:none;">
    <div class="modal-content">
      <button class="modal-close" onclick="cerrarPublicacion()">X</button>
      <div class="modal-publicacion-content" id="modalPublicacionContent">
        <!-- Se carga din√°micamente -->
      </div>
    </div>
  </div>

  <!-- Modal Editar Perfil -->
  <div class="modal-publicacion" id="modalEditarPerfil" style="display:none;">
    <div class="modal-content" style="max-width: 500px;">
      <button class="modal-close" onclick="cerrarModalEditarPerfil()">X</button>
      <div style="padding: 30px;">
        <h2 style="margin-bottom: 20px;">Editar perfil</h2>
        <form id="formEditarPerfil" method="post" action="/Home/ActualizarPerfil" enctype="multipart/form-data">
          @Html.AntiForgeryToken()
          <div class="form-group">
            <label>Nombre</label>
            <input type="text" name="Nombre" value="@nombreUsuario" required />
          </div>
          <div class="form-group">
            <label>Apellido</label>
            <input type="text" name="Apellido" value="@apellidoUsuario" required />
          </div>
          <div class="form-group">
            <label>Pa√≠s</label>
            <select name="Pais" id="paisSelect" required>
              <option value="">Seleccionar pa√≠s</option>
            </select>
          </div>
          <div class="form-group">
            <label>Descripci√≥n</label>
            <textarea name="Descripcion" rows="4">@descripcion</textarea>
          </div>
          <div class="form-group">
            <label>Foto de perfil</label>
            <input type="file" name="FotoPerfil" accept="image/*" id="fotoPerfilInput" />
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('fotoPerfilInput').click()" style="margin-top: 10px; width: auto;">Seleccionar imagen</button>
            <div id="fotoPreview" style="margin-top: 15px; text-align: center;">
              <img src="@fotoPerfil" alt="Preview" id="fotoPreviewImg" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--verde); cursor: pointer;" onclick="document.getElementById('fotoPerfilInput').click()" />
            </div>
          </div>
          <button type="submit" class="btn">Guardar cambios</button>
          <button type="button" class="btn btn-secondary" onclick="cerrarModalEditarPerfil()" style="margin-top: 10px;">Cancelar</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Nueva Publicaci√≥n -->
  <div class="modal-publicacion" id="modalNuevaPublicacion" style="display:none;">
    <div class="modal-content" style="max-width: 600px;">
      <button class="modal-close" onclick="cerrarModalNuevaPublicacion()">X</button>
      <div style="padding: 30px;">
        <h2 style="margin-bottom: 20px;">Nueva publicaci√≥n</h2>
        <form id="formNuevaPublicacion" method="post" action="/Home/CrearPublicacion" enctype="multipart/form-data">
          @Html.AntiForgeryToken()
          <div class="form-group">
            <label>Imagen *</label>
            <input type="file" name="imagen" accept="image/*" id="imagenPublicacionInput" required style="display: none;" />
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('imagenPublicacionInput').click()" style="width: auto; margin-bottom: 10px;">Seleccionar imagen</button>
            <div id="imagenPreview" style="margin-top: 15px; display: none; text-align: center;">
              <img id="previewImg" src="" alt="Preview" style="max-width: 100%; max-height: 400px; border-radius: 8px; object-fit: contain; border: 2px solid var(--verde);" />
              <button type="button" class="btn btn-secondary" onclick="document.getElementById('imagenPublicacionInput').value=''; document.getElementById('imagenPreview').style.display='none';" style="margin-top: 10px; width: auto;">Eliminar imagen</button>
            </div>
          </div>
          <div class="form-group">
            <label>Mascota (opcional)</label>
            <select name="idMascota" id="mascotaSelect">
              <option value="">Sin mascota</option>
              @foreach (var mascota in mascotas)
              {
                <option value="@mascota.Id_Mascota">@mascota.Nombre</option>
              }
            </select>
          </div>
          <div class="form-group">
            <label>Descripci√≥n</label>
            <textarea name="descripcion" rows="4" placeholder="Escribe una descripci√≥n..."></textarea>
          </div>
          <button type="submit" class="btn">Publicar</button>
          <button type="button" class="btn btn-secondary" onclick="cerrarModalNuevaPublicacion()" style="margin-top: 10px;">Cancelar</button>
        </form>
      </div>
    </div>
  </div>
</main>

<script>
const menu = document.getElementById("menuLateral");
const overlay = document.getElementById("overlay");
document.getElementById("abrirMenu").onclick = () => {
    menu.classList.add("abierto");
    overlay.classList.add("activo");
};
document.getElementById("cerrarMenu").onclick = cerrarMenu;
overlay.onclick = cerrarMenu;
function cerrarMenu() {
    menu.classList.remove("abierto");
    overlay.classList.remove("activo");
}

// Funciones para publicaciones
function abrirPublicacion(id) {
    // Cargar publicaci√≥n completa con comentarios
    fetch(`/Home/ObtenerComentarios?publicacionId=${id}`)
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                // Mostrar modal con publicaci√≥n completa
                document.getElementById('modalPublicacion').style.display = 'flex';
                // Aqu√≠ cargar√≠as la publicaci√≥n completa
            }
        });
}

function cerrarPublicacion() {
    document.getElementById('modalPublicacion').style.display = 'none';
}

function likePublicacion(id) {
    fetch('/Home/LikePublicacion', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ publicacionId: id })
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            // Actualizar UI
            location.reload();
        }
    });
}

function comentarPublicacion(id) {
    const contenido = prompt('Escrib√≠ tu comentario:');
    if (contenido) {
        fetch('/Home/ComentarPublicacion', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ publicacionId: id, contenido: contenido })
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        });
    }
}

function compartirPublicacion(id) {
    fetch('/Home/CompartirPublicacion', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ publicacionId: id })
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            alert('Publicaci√≥n compartida');
        }
    });
}

function anclarPublicacion(id) {
    if (confirm('¬øAnclar esta publicaci√≥n?')) {
        fetch('/Home/AnclarPublicacion', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ publicacionId: id, anclar: true })
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        });
    }
}

// Funciones para amigos
function agregarAmigo(id) {
    fetch('/Home/AgregarAmigo', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: '' })
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message || 'Error al agregar amigo');
        }
    });
}

function eliminarAmigo(id) {
    if (confirm('¬øEliminar de tus amigos?')) {
        fetch('/Home/EliminarAmigo', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ amigoId: id })
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        });
    }
}

function abrirChat(id) {
    window.location.href = `/Home/Mensajes?userId=${id}`;
}

// Funciones para historias
function verHistoria(id) {
    // Implementar visor de historias
    alert('Ver historia ' + id);
}

function verHistoriaDestacada(id) {
    // Implementar visor de historias destacadas
    alert('Ver historia destacada ' + id);
}

function mostrarPublicaciones(vista) {
    // Cambiar entre vista grid y lista
    const grid = document.getElementById('publicacionesGrid');
    if (vista === 'grid') {
        grid.className = 'publicaciones-grid';
    } else {
        grid.className = 'publicaciones-lista';
    }
}

// Funciones para modales
function abrirModalEditarPerfil() {
    const modal = document.getElementById('modalEditarPerfil');
    if (modal) {
        modal.style.display = 'flex';
        // Cargar pa√≠ses despu√©s de un peque√±o delay para asegurar que el DOM est√© listo
        setTimeout(cargarPaises, 100);
    }
}

function cerrarModalEditarPerfil() {
    const modal = document.getElementById('modalEditarPerfil');
    if (modal) {
        modal.style.display = 'none';
    }
}

function abrirModalNuevaPublicacion() {
    document.getElementById('modalNuevaPublicacion').style.display = 'flex';
}

function cerrarModalNuevaPublicacion() {
    document.getElementById('modalNuevaPublicacion').style.display = 'none';
}

// Preview de foto de perfil
const fotoPerfilInput = document.getElementById('fotoPerfilInput');
if (fotoPerfilInput) {
    fotoPerfilInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Validar tama√±o (m√°ximo 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('La imagen es demasiado grande. Por favor selecciona una imagen menor a 5MB.');
                this.value = '';
                return;
            }
            
            // Validar tipo
            if (!file.type.startsWith('image/')) {
                alert('Por favor selecciona un archivo de imagen v√°lido.');
                this.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('fotoPreviewImg');
                if (preview) {
                    preview.src = e.target.result;
                    // Tambi√©n actualizar la foto principal del perfil
                    const fotoPrincipal = document.querySelector('.perfil-foto');
                    if (fotoPrincipal) fotoPrincipal.src = e.target.result;
                }
            };
            reader.readAsDataURL(file);
        }
    });
}

// Preview de imagen de publicaci√≥n
const imagenPublicacionInput = document.getElementById('imagenPublicacionInput');
if (imagenPublicacionInput) {
    imagenPublicacionInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Validar tama√±o (m√°ximo 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('La imagen es demasiado grande. Por favor selecciona una imagen menor a 10MB.');
                this.value = '';
                return;
            }
            
            // Validar tipo
            if (!file.type.startsWith('image/')) {
                alert('Por favor selecciona un archivo de imagen v√°lido.');
                this.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('previewImg');
                const previewContainer = document.getElementById('imagenPreview');
                if (preview) {
                    preview.src = e.target.result;
                    previewContainer.style.display = 'block';
                }
            };
            reader.readAsDataURL(file);
        }
    });
}

// Manejar env√≠o de formulario de nueva publicaci√≥n
const formNuevaPublicacion = document.getElementById('formNuevaPublicacion');
if (formNuevaPublicacion) {
    formNuevaPublicacion.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const imagenInput = document.getElementById('imagenPublicacionInput');
        if (!imagenInput.files || imagenInput.files.length === 0) {
            alert('Por favor selecciona una imagen');
            return;
        }
        
        const formData = new FormData();
        
        // Agregar imagen
        formData.append('imagen', imagenInput.files[0]);
        
        // Agregar descripci√≥n
        const descripcion = this.querySelector('textarea[name="descripcion"]').value;
        formData.append('descripcion', descripcion || '');
        
        // Agregar mascota si est√° seleccionada
        const idMascota = this.querySelector('select[name="idMascota"]').value;
        if (idMascota) {
            formData.append('idMascota', idMascota);
        }
        
        // Agregar token anti-forgery
        const token = this.querySelector('input[name="__RequestVerificationToken"]');
        if (token) {
            formData.append('__RequestVerificationToken', token.value);
        }
        
        const btnSubmit = this.querySelector('button[type="submit"]');
        btnSubmit.disabled = true;
        btnSubmit.textContent = 'Publicando...';
        
        fetch('/Home/CrearPublicacion', {
            method: 'POST',
            body: formData
        })
        .then(r => {
            if (r.ok) {
                return r.json();
            }
            return r.text().then(text => {
                console.error('Error del servidor:', text);
                throw new Error('Error en la respuesta del servidor: ' + r.status);
            });
        })
        .then(data => {
            if (data.success) {
                cerrarModalNuevaPublicacion();
                location.reload();
            } else {
                alert('Error al crear la publicaci√≥n: ' + (data.message || 'Error desconocido'));
                btnSubmit.disabled = false;
                btnSubmit.textContent = 'Publicar';
            }
        })
        .catch(err => {
            console.error('Error:', err);
            alert('Error al crear la publicaci√≥n. Por favor intenta nuevamente.');
            btnSubmit.disabled = false;
            btnSubmit.textContent = 'Publicar';
        });
    });
}
// Cargar pa√≠ses usando country-state-city
function cargarPaises() {
    const paisSelect = document.getElementById('paisSelect');
    if (!paisSelect) return;
    
    const paisActual = '@pais';
    
    // Esperar a que la librer√≠a est√© cargada
    if (typeof window.csc !== 'undefined') {
        const { Country } = window.csc;
        const countries = Country.getAllCountries();
        
        // Funci√≥n para obtener bandera
        const flag = a2 => String.fromCodePoint(...[...a2.toUpperCase()].map(c => 127397 + c.charCodeAt(0)));
        
        // Limpiar y llenar select
        paisSelect.innerHTML = '<option value="">Seleccionar pa√≠s</option>';
        
        countries.forEach(country => {
            const option = document.createElement('option');
            option.value = country.name;
            option.textContent = `${flag(country.isoCode)} ${country.name}`;
            if (country.name === paisActual || country.isoCode === paisActual) {
                option.selected = true;
            }
            paisSelect.appendChild(option);
        });
    } else {
        // Fallback si no est√° disponible la librer√≠a
        const paisesComunes = [
            'Argentina', 'Brasil', 'Chile', 'Colombia', 'M√©xico', 'Per√∫', 
            'Espa√±a', 'Estados Unidos', 'Uruguay', 'Paraguay', 'Bolivia', 
            'Ecuador', 'Venezuela', 'Costa Rica', 'Panam√°', 'Rep√∫blica Dominicana'
        ];
        
        paisesComunes.forEach(p => {
            const option = document.createElement('option');
            option.value = p;
            option.textContent = p;
            if (p === paisActual) {
                option.selected = true;
            }
            paisSelect.appendChild(option);
        });
    }
}

// Cargar script de pa√≠ses
function initPaises() {
    if (typeof window.csc !== 'undefined') {
        // La librer√≠a ya est√° cargada
        if (document.getElementById('paisSelect')) {
            cargarPaises();
        }
    } else {
        // Esperar a que se cargue
        setTimeout(initPaises, 100);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Intentar cargar pa√≠ses despu√©s de un delay
    setTimeout(initPaises, 300);
});
</script>
</body>
</html>
